wget -O wordpress.tar.gz http://wordpress.org/latest.tar.gz
# VERSION=3.5.1
# wget -O wordpress.tar.gz http://cs.wordpress.org/wordpress-$VERSION-cs_CZ.tar.gz
tar xzf wordpress.tar.gz
sudo cp -R wordpress /var/www
sudo chown -R www-data /var/www/wordpress

mysql -u root -p
CREATE DATABASE wordpress;
CREATE USER 'wordpress-user';
SET PASSWORD FOR 'wordpress-user' = PASSWORD("wpass321*");
GRANT ALL PRIVILEGES ON wordpress.* TO 'wordpress-user'@localhost IDENTIFIED BY 'wpass321*';
FLUSH PRIVILEGES;
exit

sudo vi /var/www/wordpress/.htaccess
RewriteBase /
RewriteRule . /index.php [L]

sudo vi /etc/apache2/sites-available/wordpress
<VirtualHost *:80>
    ServerAdmin admin@example.com
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/wordpress

    <Directory /var/www/wordpress>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order Allow,Deny
        Allow from All
    </Directory>

    LogLevel warn
    ErrorLog /var/log/apache2/wordpress_error.log
    CustomLog /var/log/apache2/wordpress_access.log combined

    RewriteEngine On
    # Redirect http to https
#    RewriteCond %{HTTPS} off
#    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

    # Remove www prefix
#    RewriteCond %{HTTP_HOST} ^www.example.com$ [NC]
#    RewriteRule ^\/?(.*)$ http://example.com/$1 [R=301,L]

    # Add www prefix
    RewriteCond %{HTTP_HOST} ^example.com$
    RewriteRule (.*) http://www.example.com$1 [R=301]

    # Settings for CGI
    ScriptAlias /local-bin /usr/bin
    AddHandler application/x-httpd-php5 php
    Action application/x-httpd-php5 /local-bin/php-cgi
    
    Alias /data /media/data
    <Directory /media/data>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order allow,deny
        Allow from all
    </Directory>
</VirtualHost>

sudo vi /etc/apache2/sites-available/wordpress-ssl
<VirtualHost *:443>
    ServerAdmin admin@example.com
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/wordpress

    <Directory /var/www/wordpress>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order Allow,Deny
        Allow from All
    </Directory>

    LogLevel warn
    ErrorLog /var/log/apache2/wordpress_ssl_error.log
    CustomLog /var/log/apache2/wordpress_ssl_access.log combined

    RewriteEngine On
    # Remove www prefix
#    RewriteCond %{HTTP_HOST} ^www.example.com$ [NC]
#    RewriteRule ^\/?(.*)$ https://example.com/$1 [R=301,L]

    # Add www prefix
    RewriteCond %{HTTP_HOST} ^example.com$
    RewriteRule (.*) http://www.example.com$1 [R=301]

    SSLEngine on
    SSLCertificateFile    /etc/ssl/certs/cert-example.com.crt
    SSLCertificateKeyFile /etc/ssl/private/cert-example.com.key

    # Settings for CGI
    ScriptAlias /local-bin /usr/bin
    AddHandler application/x-httpd-php5 php
    Action application/x-httpd-php5 /local-bin/php-cgi
</VirtualHost>

# Create self-signed SSL Certificate
DOMAIN=example.com
ADMIN=admin@example.com
sudo openssl genrsa -out /etc/ssl/private/cert-$DOMAIN.key 1024 && echo -ne "\n\n\n\n\n$DOMAIN\n$ADMIN\n" | sudo openssl req -new -key /etc/ssl/private/cert-$DOMAIN.key -x509 -out /etc/ssl/certs/cert-$DOMAIN.crt -days 999

sudo a2ensite wordpress wordpress-ssl
sudo service apache2 reload
